---
typora-root-url: pic
---



æœ¬æ–‡æ‰“ç®—èŠèŠ`goframe`ï¼Œç›¸æ¯”äº`gin`ï¼Œå®ƒçš„åŠŸèƒ½é½å…¨å¤ªå¤šäº†ï¼Œå¯¹äºæ¡†æ¶æœ¬èº«çš„æœ¬èœé¸¡ä¸åšè¯„ä»·ï¼Œåæ­£æˆ‘æ¥è§¦å®ƒçš„è¿™ä¸€å¹´ï¼Œåœ¨githubä¸Šçš„è®¤å¯åº¦æ˜¯é«˜äº†ä¸å°‘ã€‚ä½†æ˜¯`goframe2.0`çš„æ–‡æ¡£ç»å¯¹æ˜¯ä¸€ä¸ªå…³äºwebæœåŠ¡å·¥ç¨‹åŒ–çš„å®è—ã€‚é˜…è¯»æ¯ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œæˆ‘éƒ½æ„Ÿè§‰åœ¨æ—è§‚ä¸€ä½å¤§ä½¬ä¸æ–­è¸©å‘å¹¶ä¸”ä¸æ–­çˆ¬å‘çš„åŠ±å¿—æ•…äº‹ã€‚

è€Œä¸”åœ¨å­¦ä¹ æ–‡æ¡£çš„è¿‡ç¨‹ï¼Œæˆ‘ä¼šæœ‰ä¸€ç§ä¼¼æˆç›¸è¯†çš„æ„Ÿè§‰ã€‚è‡ªå·±çš„å·¥ä½œä¸­ä½¿ç”¨çš„æ˜¯`gin`æ¡†æ¶ï¼Œä¸ºäº†è§£å†³æˆ‘ä»¬å›¢é˜Ÿçš„ç—›ç‚¹ï¼Œä¹Ÿåšè¿‡ä¸`goframe`ç±»ä¼¼çš„ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªåŠ¨è§£æè¯·æ±‚å‚æ•°ï¼Œä¸è¿‡æˆ‘ä»¬è®¾è®¡çš„æ²¡é‚£ä¹ˆå®Œå–„ã€‚

æ€»ä¹‹è¿™ä»½æ–‡æ¡£å¯¹æˆ‘å¯å‘å¾ˆå¤§ï¼Œæ‰€ä»¥å°±æ‰“ç®—ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œè°ˆä¸€è°ˆè‡ªå·±çš„ç†è§£ã€‚

# goframeå·¥ç¨‹åŒ–åŸºæœ¬å®è·µ



## åˆ†å±‚è®¾è®¡æ€æƒ³

æœ¬èŠ‚çš„ä¸»è¦å†…å®¹æ¥è‡ªäº

goframeçš„å®˜æ–¹æ–‡æ¡£ï¼šhttps://goframe.org/pages/viewpage.action?pageId=3672442 

åœ¨å‰åç«¯æ‰åœ¨ä¸€èµ·çš„é¡¹ç›®ä¸­ï¼ŒMVCæ˜¯æœ€æµè¡Œçš„æ¶æ„æ¨¡å¼ã€‚

### MVC

- Viewï¼ˆè§†å›¾ï¼‰
  - æˆ‘å°±ç®€å•ç²—æš´çš„ç†è§£æˆ`HTML`é¡µé¢äº†ï¼Œç”¨æˆ·é€šè¿‡å„ç§æŒ‰é’®å’Œè¾“å…¥æ¡†å¯¹åç«¯å‘èµ·è¯·æ±‚ï¼Œä¸€èˆ¬å°±æ˜¯è¯·æ±‚apiæ¥å£ã€‚å¾—åˆ°è¿”å›ç»“æœåï¼Œé‡æ–°æ¸²æŸ“åˆ°`HTML`é¡µé¢ä¸­ã€‚
  
- Controllerï¼ˆæ§åˆ¶å™¨ï¼‰
  - Viewå±‚çš„è¯·æ±‚æ¥äº†åï¼Œåç«¯è¯¥å¤„ç†äº†ã€‚Controllerä¼šè°ƒç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªModelæ¥å®ŒæˆæŒ‡ä»¤ï¼Œå®ƒæœ¬èº«ä¸ä¼šæœ‰ä»»ä½•çš„ä¸šåŠ¡é€»è¾‘ã€‚
- Modelï¼ˆæ¨¡å‹ï¼‰
  - çœŸæ­£å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ã€‚

MVCçš„å¥½å¤„æ˜¯ï¼ŒModelå±‚ä¸Viewå±‚è¢«Controllerå±‚éš”ç¦»äº†ã€‚ç”±Controllerå……å½“ä¸­é—´å±‚æ¥ä¸ºViewæŒ‘é€‰Modelï¼Œä¸€ä¸ªModelä¹Ÿèƒ½ä¸ºå¤šä¸ªä¸åŒçš„Viewä½¿ç”¨ã€‚

å½“é¡µé¢éœ€è¦æ”¹è¿›æ ·å¼æ—¶ï¼Œåªéœ€è¦é’ˆå¯¹Viewä¿®æ”¹ï¼Œè€Œä¸å½±å“Modelã€‚åŒç†ï¼Œä¸šåŠ¡é€»è¾‘å‘ç”Ÿæ”¹åŠ¨æ—¶ï¼Œä¹Ÿä¸å½±å“Viewã€‚

ä½†æ˜¯ç°åœ¨å¾ˆå¤šé¡¹ç›®éƒ½é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ–¹å¼ï¼Œåç«¯äººå‘˜åªå¯¹å‰ç«¯æä¾›æ¥å£ï¼Œå¹¶ä¸å…³å¿ƒåŸæ¥çš„Viewå±‚ã€‚åç«¯é¡¹ç›®å°±åªå‰©ä¸‹äº†MCä¸¤å±‚ã€‚è€ŒMå±‚æ˜¯é¢—ç²’åº¦è¾ƒç²—çš„ï¼š

- å¾ˆå¤šä¸šåŠ¡é€»è¾‘æœ€ç»ˆéƒ½æ˜¯å»æ“ä½œæ•°æ®åº“ï¼Œè¿™ä¸ªæ¶æ„é‡Œé¢ä¹Ÿæ²¡æœ‰å®šä¹‰æ•°æ®åº“æ“ä½œè¯¥æ”¾åœ¨å“ªï¼Œç»“æœéƒ½æ‰åœ¨äº†Modelé‡Œã€‚
- å†™ç€å†™ç€å‘ç°Controlleré‡Œé¢å‡ºç°äº†ä¸šåŠ¡é€»è¾‘ï¼Œç”šè‡³å‡ºç°äº†æ•°æ®åº“æ“ä½œã€‚

æ‰€ä»¥éœ€è¦ä¸€ç§é’ˆå¯¹åç«¯ä»£ç åˆ†å±‚èŒè´£åˆ’åˆ†é¢—ç²’åº¦æ›´ç»†çš„æ¶æ„è®¾è®¡

### 3å±‚æ¶æ„

ä¸‰å±‚æ¶æ„è®¾è®¡ï¼ˆ3-Tier Architectureï¼‰åˆ†ä¸ºè¡¨ç¤ºå±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®è®¿é—®å±‚

- è¡¨ç¤ºå±‚ï¼ˆUser Interfaceï¼‰
  - ä¸ç”¨æˆ·ç›´æ¥æ¥è§¦ï¼Œåœ¨webé¡¹ç›®ä¸­å¯ä»¥ç†è§£æˆ`API`æ¥å£ï¼Œå®ƒå°†ç”¨æˆ·çš„éœ€æ±‚ä¼ è¾¾ç»™ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¹¶å°†å¤„ç†ç»“æœåé¦ˆç»™ç”¨æˆ·ã€‚
- ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰
  - `Business Logic Layer`çš„åŠŸèƒ½æ˜¯å¯¹å…·ä½“é—®é¢˜è¿›è¡Œé€»è¾‘åˆ¤æ–­ä¸æ‰§è¡Œæ“ä½œ
  - æ¥æ”¶åˆ°è¡¨ç°å±‚`UI`çš„ç”¨æˆ·æŒ‡ä»¤åï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¸šåŠ¡é€»è¾‘å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨æ•°æ®åº“ã€‚
- æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰
  - `Data Access Layer`æ˜¯æ•°æ®åº“çš„ä¸»è¦æ“æ§ç³»ç»Ÿï¼Œå®ç°æ•°æ®çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œï¼Œå¹¶å°†æ“ä½œç»“æœåé¦ˆåˆ°ä¸šåŠ¡é€»è¾‘å±‚`BLL`ã€‚
  - å…³äºè¿™ä¸€å±‚ï¼Œåœ¨å…³äº`ORM`çš„æ–‡ç« ä¸­ä¼šè¯¦ç»†è®°å½•



3å±‚æ¶æ„ç”¨èµ·æ¥æ›´é¡ºæ‰‹ï¼Œå®ƒçš„æ€æƒ³å¾—ä½“ç°åœ¨ä»£ç çš„ç›®å½•ç»“æ„ä¸­

## æ ‡å‡†ç›®å½•ç»“æ„

ä½¿ç”¨gfå·¥å…·åˆå§‹åŒ–æ–°é¡¹ç›®ï¼š`gf init xxx`ï¼Œæ–°é¡¹ç›®çš„æ ¸å¿ƒç›®å½•å±‚çº§å¦‚ä¸‹ï¼š

gfå·¥å…·å®‰è£…ï¼šhttps://goframe.org/pages/viewpage.action?pageId=1115782 

| ç›®å½•/æ–‡ä»¶åç§° | è¯´æ˜     | æè¿°                                                         |
| ------------- | -------- | ------------------------------------------------------------ |
| api           | å¯¹å¤–æ¥å£ | å®šä¹‰å¯¹å¤–æ¥å£è¯·æ±‚å‚æ•°åŠè¿”å›å‚æ•°æ®ç»“æ„ã€‚éœ€è¦è€ƒè™‘ç‰ˆæœ¬ç®¡ç†ï¼ˆæŒ‰ç…§ç‰ˆæœ¬åˆ†åŒ…ï¼‰ |
| internal      |          |                                                              |
| ---cmd        | å…¥å£æŒ‡ä»¤ | goframeé¼“åŠ±ä½¿ç”¨å‘½ä»¤çš„å½¢å¼å¯åŠ¨æœåŠ¡ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚å®šä¹‰ä¸åŒçš„å‘½ä»¤ |
| ---controller | æ¥å£å¤„ç† | å¯¹å¤–æ¥å£çš„å®ç°ï¼Œä¾é è°ƒç”¨serviceå®ç°é€»è¾‘                      |
| ---service    | ä¸šåŠ¡æ¥å£ | ä¸šåŠ¡é€»è¾‘çš„æ¥å£ï¼ˆinterfaceå®šä¹‰ï¼‰                              |
| ---logic      | ä¸šåŠ¡å°è£… | ä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œé€šå¸¸ä¼šè°ƒç”¨daoå±‚å¤„ç†æ•°æ®                      |
| ---dao        | æ•°æ®è®¿é—® | æ•°æ®è®¿é—®å¯¹è±¡                                                 |
| ---model      | ç»“æ„æ¨¡å‹ |                                                              |
| ------do      | é¢†åŸŸå¯¹è±¡ | logicè°ƒç”¨daoå±‚æ—¶ï¼Œå‚æ•°è½¬åŒ–æ—¶éœ€è¦ç”¨åˆ°çš„ï¼Œè¯¦è§DALå±‚çš„ä»‹ç»      |
| ------entity  | æ•°æ®æ¨¡å‹ | ä¸æ•°æ®åº“è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”çš„æ•°æ®å®ä½“ï¼Œç”±å·¥å…·ç»´æŠ¤ï¼Œç”¨æˆ·ä¸èƒ½ä¿®æ”¹   |
| ------xxx.go  | ä¸šåŠ¡æ¨¡å‹ | serviceéœ€è¦ç”¨åˆ°çš„æ•°æ®å®ä½“                                    |
| main.go       | å…¥å£æ–‡ä»¶ | ç¨‹åºå…¥å£æ–‡ä»¶                                                 |

æ–‡æ¡£ä¸­çš„è¿™ä¸ªç›®å½•è¯´æ˜çœ‹ç€ä¼šæœ‰äº›æ‡µåœˆï¼Œå¾—ç»“åˆç€ä»£ç ä¸€èµ·çœ‹



## åˆ†å±‚åˆ†æå®è·µ

åŸºäºä»¥ä¸‹ç¤ºä¾‹åšä¸ºåˆ†æåŸºç¡€ï¼š

goframeå®˜æ–¹ç¤ºä¾‹é¡¹ç›®ï¼šhttps://github.com/gogf/gf-demo-user 

### ä¸‰å±‚

#### UIå±‚

`api` + `internale/controller`å…±åŒå®ç°äº†UIå±‚

- `api`æ˜¯å¯¹å¤–æ¥å£çš„å‚æ•°å®šä¹‰ï¼ˆè·¯ç”±ç»‘å®šä¸åœ¨æ­¤ï¼Œä¼šæœ‰å•ç‹¬ä¸€ç¯‡æ–‡ç« åˆ†æï¼‰

- `controller`æ˜¯å¯¹å¤–æ¥å£çš„å®ç°ï¼Œè°ƒç”¨å†…éƒ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªserviceå®ç°åŒ…ä¸šåŠ¡é€»è¾‘

ä»¥ç¤ºä¾‹é¡¹ç›®ä¸­çš„`/user/sign-up`æ¥å£ä¸ºä¾‹

- `api`ä¸­çš„å®šä¹‰ï¼š

  ```go
  type UserSignUpReq struct {
  	g.Meta    `path:"/user/sign-up" method:"post" tags:"UserService" summary:"Sign up a new user account"`
  	Passport  string `v:"required|length:6,16"`
  	Password  string `v:"required|length:6,16"`
  	Password2 string `v:"required|length:6,16|same:Password"`
  	Nickname  string
  }
  type UserSignUpRes struct{}
  ```

  - `g.Meta`å¯ç†è§£ä¸ºä¸€ä¸ªæ ‡è®°ä½ï¼Œå®ƒçš„æ³¨è§£ä¼šè¢«`gf`å·¥å…·è¯†åˆ«åˆ°ï¼Œæ–¹ä¾¿åšä¸€äº›ä»£ç ç”Ÿæˆä¹‹ç±»çš„å·¥ä½œã€‚

- `controller`ä¸­çš„å®ç°ï¼š

  ```go
  var User = cUser{}
  
  type cUser struct{}
  
  func (c *cUser) SignUp(ctx context.Context, req *v1.UserSignUpReq) (res *v1.UserSignUpRes, err error) {
  	err = service.User().Create(ctx, model.UserCreateInput{
  		Passport: req.Passport,
  		Password: req.Password,
  		Nickname: req.Nickname,
  	})
  	return
  }
  ```

  - å¯¹å¤–æš´éœ²äº†`User`ç»“æ„ä½“å®ä¾‹ï¼Œä¾¿äºè·¯ç”±ç»‘å®šï¼Œè·¯ç”±ç»‘å®šåœ¨`/internal/cmd`çš„mainå‘½ä»¤ä¸­

    ```go
    group.Bind(
    	controller.User,
    )
    ```

    - `Bind`æ–¹å¼ä¼šå°†æ¥å£å®šä¹‰ä¸­`g.Meta`ä¸­æ‰“çš„æ³¨è§£è§£æå‡ºæ¥ï¼Œç»‘å®šè·¯ç”±

  - `(c *cUser) SignUp`æ–¹æ³•é€šè¿‡è°ƒç”¨`service`æ¥å®ç°æ¥å£



â—é—®é¢˜ï¼šæ²¡æœ‰ä»»ä½•è§£æåŠ¨ä½œï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚å‚æ•°ä»€ä¹ˆæ—¶å€™ç»‘å®šåˆ°äº†`UserSignUpReq`å„ä¸ªå­—æ®µä¸Šï¼Ÿ

â—é—®é¢˜ï¼š`controller`çš„`SignUp()`æ–¹æ³•å…¥å‚æ²¡æœ‰äº†`*ghttp.Request`ï¼ˆginä¸­å¯¹åº”çš„æ˜¯`*gin.Context`ï¼‰,è¿™æ¡è°ƒç”¨é“¾éœ€è¦ç”¨åˆ°è¯¥æ€ä¹ˆåŠï¼Ÿ

è¿™ä¸¤ä¸ªé—®é¢˜éƒ½æ”¾åœ¨è·¯ç”±ç»‘å®šç¯‡å»æè¿°äº†



#### BLLå±‚

`internal/service` + `internal/logic`å…±åŒå®ç°äº†BLLå±‚

- `service`æ˜¯ä¸šåŠ¡é€»è¾‘çš„æ¥å£å®šä¹‰ï¼ˆInterfaceï¼‰

- `logic`æ˜¯serviceçš„å®ç°ï¼ˆæŒ‰æ¨¡å—åˆ†åŒ…ï¼‰

ä»¥ç¤ºä¾‹é¡¹ç›®ä¸­çš„`/user/sign-up`æ¥å£ä¸ºä¾‹ï¼Œ`controller`å±‚å¯¹`service`å‘èµ·äº†è°ƒç”¨

```go
var User = cUser{}

type cUser struct{}

func (c *cUser) SignUp(ctx context.Context, req *v1.UserSignUpReq) (res *v1.UserSignUpRes, err error) {
	err = service.User().Create(ctx, model.UserCreateInput{
		Passport: req.Passport,
		Password: req.Password,
		Nickname: req.Nickname,
	})
	return
}
```

- serviceå±‚interfaceå®šä¹‰ï¼š

  ```go
  type IUser interface {
  	Create(ctx context.Context, in model.UserCreateInput) (err error)
  }
  
  var localUser IUser
  
  func User() IUser {
  	if localUser == nil {
  		panic("implement not found for interface IUser, forgot register?")
  	}
  	return localUser
  }
  
  func RegisterUser(i IUser) {
  	localUser = i
  }
  ```

  - `IUser`å®šä¹‰äº†BLLå±‚å¯¹å¤–æä¾›çš„èƒ½åŠ›
  - é€šè¿‡`User()`æ–¹æ³•å¯¹å¤–æš´éœ²`IUser`çš„å®ä¾‹`localUser`ï¼Œå®ä¾‹æ˜¯å®ç°ä½“ï¼ˆ`logicåŒ…`ä¸­ï¼‰é€šè¿‡`RegisterUser()`æ–¹æ³•èµ‹å€¼çš„
    - é€šè¿‡`Registerxxx()`çš„è®¾è®¡ï¼Œ`service`åŒ…åšä¸ºinterfaceå®šä¹‰çš„åŒ…ï¼Œå®ƒä¸éœ€è¦`import`å®ç°è€…çš„åŒ…

- serviceå±‚ä¸šåŠ¡é€»è¾‘å®ç°

  ```go
  type (
  	sUser struct{}
  )
  
  func init() {
  	service.RegisterUser(New())
  }
  
  func New() *sUser {
  	return &sUser{}
  }
  
  // Create creates user account.
  func (s *sUser) Create(ctx context.Context, in model.UserCreateInput) (err error) {
  	// xxxxä¸šåŠ¡é€»è¾‘ä»£ç xxxx
  	return dao.User.Transaction(ctx, func(ctx context.Context, tx *gdb.TX) error {
  		_, err = dao.User.Ctx(ctx).Data(do.User{
  			Passport: in.Passport,
  			Password: in.Password,
  			Nickname: in.Nickname,
  		}).Insert()
  		return err
  	})
  }
  ```
  
  - `sUser`å®ç°äº†`serviceåŒ…`ä¸­å®šä¹‰çš„`IUser`
  - åœ¨`init()`æ–¹æ³•ä¸­è°ƒç”¨`service.RegisterUser()`
  - `Create()`å°±æ˜¯ä¸šåŠ¡é€»è¾‘äº†ï¼Œé€šå¸¸å°‘ä¸äº†å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œæ‰€ä»¥å¼•ç”¨äº†`dao`å±‚ä»£ç ï¼Œä½†è¿™æ˜¯ä¼¼ä¹å’Œå¹³æ—¶é¡¹ç›®å¼€å‘ä¸å¤ªä¸€æ ·ï¼Œè§DALå±‚æè¿°
  
  
  
  â—é—®é¢˜ï¼šcontrollerå±‚ç›´æ¥å†™ä¸šåŠ¡é€»è¾‘ä¸å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¦å¤šserviceè¿™ä¸€å±‚ï¼Ÿ
  
  `controller`ä¸€èˆ¬ä¼šè°ƒç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ª`service`æ¥å®ç°æ¥å£é€»è¾‘ ï¼Œ`service`ä¹‹é—´æœ‰å¯èƒ½ä¹Ÿä¼šç›¸äº’è°ƒç”¨ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿`service`ä»£ç çš„å¤ç”¨æ€§ã€‚å¦‚æœæ²¡æœ‰serviceè¿™ä¸€å±‚ï¼Œä»£ç å¤ç”¨æ€§ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚
  
  
  
  â—é—®é¢˜ï¼šå°±ç®—å¤šäº†è¿™ä¸€å±‚ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æŠ½è±¡å‡ºinterfaceè¿™ä¸€å±‚ï¼Œæå¾—æ¯æ¬¡åŠ ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜å¾—å¤šæ”¹ä¸€å¤„åœ°æ–¹ï¼Ÿ
  
  æœ‰äº†interfaceä¹‹åï¼Œä¼šå‘ç°å„ä¸ªå±‚çº§å’Œ`logic`ä¹‹é—´æ²¡æœ‰ç›´æ¥importçš„å…³ç³»äº†ï¼Œè¿™å°±è§£è€¦äº†ã€‚å¦å¤–`logic`ä¸­ä¸åŒæ¨¡å—ä¹‹é—´ç›¸äº’è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`service`å±‚ï¼Œä¸ç”¨æ‹…å¿ƒå¾ªç¯importçš„å™©æ¢¦äº†ã€‚
  
  
  

#### DALå±‚

`internal/dao`å®ç°äº†DALå±‚

å¯¹äºDALå±‚ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œéƒ½æ˜¯æŒ‰ç…§è¡¨æ¥åˆ†`goæ–‡ä»¶`ï¼Œæ¯ä¸ªæ–‡ä»¶åŒ…å«ç€å¯¹è¯¥è¡¨çš„`DDLæ“ä½œ`ï¼Œä»¥ä¾›`BLL`å±‚è°ƒç”¨ï¼Œå¦‚ï¼š

```go
func Create(...) (...) {...}
func Delete(...) (...) {...}
func Get(...) (...) {...}
func Update(...) (...) {...}
```

ä½†æ˜¯ä¸šåŠ¡ç¨å¾®æ‰©å¤§ä¸€ç‚¹åï¼Œç®€å•çš„å¢åˆ æ”¹æŸ¥å°±æ»¡è¶³ä¸äº†ï¼ŒæŸ¥è¯¢æ¡ä»¶å¤šäº†ï¼Œå¹¶ä¸”ææœ‰å¯èƒ½æ¶‰åŠè”è¡¨ï¼Œäºæ˜¯è¿™ä¸ª`goæ–‡ä»¶`å¼€å§‹å˜å¾—è¶Šæ¥è¶Šå¤§ã€‚è¿™éƒ½æŒºæ­£å¸¸ï¼Œæ¯•ç«Ÿä¸šåŠ¡éœ€æ±‚å°±æœ‰è¿™ä¹ˆå¤æ‚ã€‚

åœ¨goframeä¸­ï¼Œé¼“åŠ±å¦å¤–ä¸€ç§åšæ³•ï¼š

 ![](/daoå±‚èŒè´£.png)

ä¸€å¼€å§‹ä¹Ÿæ²¡çœ‹æ˜ç™½ï¼Œäºæ˜¯æ‰¾äº†è‡ªå·±é¡¹ç›®ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªdaoæ–‡ä»¶ï¼Œå‘ç°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼š

- æ–¹æ³•éå¸¸å¤šï¼Œå¹¶ä¸”é‡å¤åŠŸèƒ½çš„æ–¹æ³•ä¹Ÿå¾ˆå¤š

å…¶å®è¿™ä¹Ÿèƒ½ç†è§£ï¼Œé¡¹ç›®å¤§éƒ½æ˜¯åä½œå¼€å‘çš„ï¼Œæ¯æ¬¡å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œå‘ç°éœ€è¦äº›æ•°æ®åº“æ“ä½œæ—¶ï¼Œéƒ½ä¼šé‡å†™ä¸€ä¸ªdaoæ–¹æ³•ï¼Œå³ä½¿è¿™ä¸ªåŒ…é‡Œé¢å·²ç»æœ‰èƒ½å®ç°åŠŸèƒ½çš„æ–¹æ³•äº†ï¼Œåªè¦ä¸æ˜¯è‡ªå·±å†™çš„ã€‚å› ä¸ºåˆ«äººå†™çš„æ€•æ”¹äº†ã€‚è¿­ä»£å‡ ä¸ªç‰ˆæœ¬åï¼Œè¿™é‡Œå°±å †æˆå±±äº†ã€‚

åŸæœ¬æ”¾åœ¨daoçš„ä»£ç ï¼Œç§»åˆ°serivceåï¼Œæœ‰ä¸ªé—®é¢˜ï¼šserviceå±‚ä¸è¦å‡ºç°ç¡¬ç¼–ç 

- è¿™ä¸ªé—®é¢˜åœ¨ä»¥å‰çš„daoå±‚å°±ç»å¸¸å‡ºç°ï¼Œå¦‚ï¼š

  ```go
  err = db.Table("user").Where("id = ?", id).Scan(&u).Error
  ```

  è¿™ç§è¿˜æ˜¯åˆ©ç”¨äº†ormçš„å·¥å…·ï¼Œç›´æ¥sqlçš„æƒ…å†µä¸‹æ›´åˆºçœ¼ï¼Œå·¨å®¹æ˜“å†™é”™ã€‚åŸdaoå±‚çš„é—®é¢˜ï¼Œä¸èƒ½æŠ›åˆ°serviceå±‚


é‚£æ–°çš„daoå±‚è¯¥åšä»€ä¹ˆï¼Œå½“ç„¶åŸåˆ™ä¾ç„¶æ˜¯ä¸ºserviceå±‚æœåŠ¡

é¦–å…ˆæ˜¯ormçš„é—®é¢˜ï¼Œgoframeæä¾›äº†è‡ªå·±çš„ormï¼šhttps://goframe.org/pages/viewpage.action?pageId=1114686

å¹¶ä¸”æå‡ºäº†å…¶ä»–çš„ormçš„ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼šhttps://goframe.org/pages/viewpage.action?pageId=17203240 ï¼ˆæ€€ç–‘å°±æ˜¯è¯´ç»™gormçš„ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰è¯æ®ğŸ¶ï¼‰ï¼Œå…³äºè¿™ç¯‡æ–‡ç« ä¸­æå‡ºæ¥çš„é—®é¢˜ï¼Œæˆ‘ç‰¹æ„é€æ¡å»å¯¹æ¯”äº†ï¼Œæ”¾åœ¨ä¸“é—¨çš„ormåˆ†æç¯‡

å›åˆ°ç°åœ¨çš„daoå±‚ï¼Œè¯¥åšä»€ä¹ˆï¼Œè¿˜æ˜¯ä»¥userè¡¨ä¸ºä¾‹ï¼Œdaoå±‚çš„å†…å®¹å¯åˆ†ä¸‰éƒ¨åˆ†ï¼š

 ![](/daoå±‚å†…å®¹.png)

- modelåŒ…ä¸­æ˜¯ç»“æ„ä½“

  - entity/user.goä¸­æ˜¯è¡¨ç»“æ„çš„æ˜ å°„ï¼š

    ```go
    package entity
    
    // User is the golang structure for table user.
    type User struct {
    	Id       uint      `json:"id"       description:"User ID"`       // User ID
    	Password string    `json:"password" description:"User Password"` // User Password
    	Name     string    `json:"name"     description:"User Nickname"` // User Nickname
    	CreateAt time.Time `json:"createAt" description:"Created Time"`  // Created Time
    	UpdateAt time.Time `json:"updateAt" description:"Updated Time"`  // Updated Time
    }
    ```

  - do/user.goä¸­ï¼š

    ```go
    package do
    
    import (
    	"github.com/gogf/gf/v2/frame/g"
    )
    
    // Job is the golang structure of table job for DAO operations like Where/Data.
    type Job struct {
    	g.Meta     `orm:"table:job, do:true"`
    	Id         interface{} // Job ID
    	JobName    interface{} // Job Name
    	JobAddress interface{} // Job Address
    	CreateAt   interface{} // Create Time
    	UpdateAt   interface{} // Update Time
    }
    ```

    å®ƒæ˜¯ç”¨æ¥åšserviceå±‚çš„æ•°æ®æ¨¡å‹ä¸è¡¨ç»“æ„æ˜ å°„æ¨¡å‹çš„è½¬åŒ–ç”¨ï¼Œä½¿ç”¨è§åé¢çš„ä¾‹å­

- dao/internal/user.goæ˜¯çœŸæ­£çš„daoå±‚å†…å®¹ï¼š

  ```go
  package internal
  
  import (
  	"context"
  	"github.com/gogf/gf/v2/database/gdb"
  	"github.com/gogf/gf/v2/frame/g"
  )
  
  // UserDao is the data access object for table user.
  type UserDao struct {
  	table   string      // table is the underlying table name of the DAO.
  	group   string      // group is the database configuration group name of current DAO.
  	columns UserColumns // columns contains all the column names of Table for convenient usage.
  }
  
  // UserColumns defines and stores column names for table user.
  type UserColumns struct {
  	Id       string // User ID
  	Password string // User Password
  	Name     string // User Nickname
  	CreateAt string // Created Time
  	UpdateAt string // Updated Time
  }
  
  // userColumns holds the columns for table user.
  var userColumns = UserColumns{
  	Id:       "id",
  	Password: "password",
  	Name:     "name",
  	CreateAt: "create_at",
  	UpdateAt: "update_at",
  }
  
  // NewUserDao creates and returns a new DAO object for table data access.
  func NewUserDao() *UserDao {
  	return &UserDao{
  		group:   "default",
  		table:   "user",
  		columns: userColumns,
  	}
  }
  
  // DB retrieves and returns the underlying raw database management object of current DAO.
  func (dao *UserDao) DB() gdb.DB {
  	return g.DB(dao.group)
  }
  
  // Table returns the table name of current dao.
  func (dao *UserDao) Table() string {
  	return dao.table
  }
  
  // Columns returns all column names of current dao.
  func (dao *UserDao) Columns() UserColumns {
  	return dao.columns
  }
  
  // Group returns the configuration group name of database of current dao.
  func (dao *UserDao) Group() string {
  	return dao.group
  }
  
  // Ctx creates and returns the Model for current DAO, It automatically sets the context for current operation.
  func (dao *UserDao) Ctx(ctx context.Context) *gdb.Model {
  	return dao.DB().Model(dao.table).Safe().Ctx(ctx)
  }
  
  // Transaction wraps the transaction logic using function f.
  // It rollbacks the transaction and returns the error from function f if it returns non-nil error.
  // It commits the transaction and returns nil if function f returns nil.
  //
  // Note that, you should not Commit or Rollback the transaction in function f
  // as it is automatically handled by this function.
  func (dao *UserDao) Transaction(ctx context.Context, f func(ctx context.Context, tx gdb.TX) error) (err error) {
  	return dao.Ctx(ctx).Transaction(ctx, f)
  }
  ```

  çœ‹ç€å†…å®¹å¤šï¼Œä¸»è¦å°±æ˜¯ï¼š

  - è¡¨çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚è¡¨åå­—ã€å­—æ®µåç­‰
  - ç»´æŠ¤ä½æ•°æ®åº“é“¾æ¥ï¼Œå°±æ˜¯gormä¸­çš„é‚£ä¸ªgorm.DB
  - å¼€å¯äº‹åŠ¡çš„æ–¹å¼

dao/user.goå°±æ˜¯å¯¹å¤–æš´éœ²ä¸€ä¸ªuserdaoçš„å®ä¾‹ï¼Œä¾›serviceä½¿ç”¨ï¼š

```go
package dao

import (
	"dao_demo/gf_dao/dao/internal"
)

// internalUserDao is internal type for wrapping internal DAO implements.
type internalUserDao = *internal.UserDao

// userDao is the data access object for table user.
// You can define custom methods on it to extend its functionality as you wish.
type userDao struct {
	internalUserDao
}

var (
	// User is globally public accessible object for table user operations.
	User = userDao{
		internal.NewUserDao(),
	}
)
```



è¿™æ ·serviceå†™ä¸€ä¸ªsqlæ“ä½œï¼Œå°±å˜æˆäº†ï¼š

```go
err = dao.User.Ctx(ctx).Where(do.User{Name: name}).Scan(&user)	
```

- é¿å…äº†ç¡¬ç¼–ç ï¼Œwhereæ¡ä»¶ä¸­æ¶‰åŠçš„å­—æ®µåï¼Œéƒ½å¯ä»¥ç”¨doä¸­å¯¹åº”çš„ç»“æ„ä½“å»æ›¿ä»£
- ormæä¾›äº†ä¾¿åˆ©çš„æ–¹æ³•ï¼ŒåŸæœ¬å¤æ‚çš„sqlè¯­å¥å†™å‡ºæ¥ä¹Ÿä¼šæ¯”è¾ƒç®€å•

ä¸è¿‡daoå±‚çš„è¿™ä¸€å¤§å †ä¸œè¥¿ï¼Œä¼¼ä¹çœ‹èµ·æ¥éƒ½æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥gfå·¥å…·ä¹Ÿæä¾›äº†è‡ªåŠ¨ç”Ÿäº§çš„æ–¹æ³•



## ç»“æ„åŒ–ç¼–ç¨‹

ç»“æ„åŒ–ç¼–ç¨‹ç®€å•è¯´ï¼Œå°±æ˜¯å‡½æ•°é€šè¿‡å®šä¹‰ç»“æ„ä½“æ¥æ¥å—å‚æ•°ã€‚

åœ¨é¡¹ç›®ä¸­ï¼Œä¸»è¦ä½“ç°åœ¨controllerã€serviceçš„å‚æ•°æ¥æ”¶



### ç»“æ„ä½“å®šä¹‰

ä¹‹å‰ä¸€ç›´æ²¡æï¼Œè¿™äº›ç»“æ„ä½“è¯¥å®šä¹‰åœ¨å“ªé‡Œ

#### å¯¹å¤–æ¥å£ï¼ˆUIå±‚ï¼‰çš„å‚æ•°ç»“æ„ä½“å®šä¹‰

è¿™ä¸€å—å®šä¹‰åœ¨`api`åŒ…ä¸­ï¼Œè¯·æ±‚å‚æ•°ç»“æ„ä½“å`xxxReq`,è¿”å›å‚ç»“æ„ä½“å`xxxRes`

- è¯·æ±‚å‚çš„å„ä¸ªå­—æ®µå¯ä»¥é€šè¿‡æ³¨è§£æ–¹å¼æ¥åšå‚æ•°æ ¡éªŒ

  - å‚æ•°æ ¡éªŒï¼šhttps://goframe.org/pages/viewpage.action?pageId=1114678 

  

- è¯·æ±‚å‚æ•°å†…è¿˜å¯ä»¥ä½¿ç”¨`g.Meta`çš„æ–¹å¼æ¥å‡å°‘è·¯ç”±ç»‘å®šæ—¶çš„å·¥ä½œé‡ï¼Œè¿˜å¯ä»¥åˆ©äºç”Ÿæˆswaggeræ–‡æ¡£

#### BLLå±‚çš„å‚æ•°ç»“æ„ä½“å®šä¹‰

åœ¨`internal/model`ä¸­ï¼Œæ¥å—å‚æ•°ç»“æ„ä½“å`xxxInput`,è¿”å›å‚æ•°ç»“æ„ä½“å`xxxOutput`

â—é—®é¢˜ï¼šå¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯¹å¤–æ¥å£å®šä¹‰çš„ç»“æ„ä½“å­—æ®µå’ŒBLLå±‚éœ€è¦çš„å­—æ®µåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œä¼šä¸ä¼šå¤šæ­¤ä¸€ä¸¾ï¼Ÿ

#### DALå±‚çš„å‚æ•°ç»“æ„ä½“å®šä¹‰

DALå±‚æœ€å…³é”®çš„å‚æ•°ç»“æ„ä½“çš„åœ¨`internal/model/entity`ä¸­ï¼Œå®ƒåº”è¯¥ä¸æ•°æ®åº“ç»“æ„ä¿æŒä¸€è‡´ã€‚

å¦å¤–goframeè¿˜æœ‰ä¸€ä¸ªç›®å½•`internal/model/do`,å®ƒçš„è§£é‡Šè§DALå±‚ç« èŠ‚





## è®©gfå»åšéº»çƒ¦äº‹

è®ºç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šæœ‰è§„åˆ™å›ºå®šçš„ã€é‡å¤ç¹çä¸”å®¹æ˜“å‡ºé”™çš„å·¥ä½œï¼Œå°±è¦è€ƒè™‘ç”¨ä»£ç è‡ªåŠ¨å»åšã€‚è¿™è¯æˆ‘è‡ªå·±ç¼–çš„ï¼Œä¸è¿‡æˆ‘è§‰å¾—æ˜¯äº‹å®ã€‚

- é¡¹ç›®åˆå§‹åŒ–
- `internal/model/entity`ä¸­ç»“æ„ä½“å®šä¹‰
- `internal/model/do`ä¸­ç»“æ„ä½“å®šä¹‰
- `internale/service`ä¸­çš„æ¥å£å®šä¹‰
  - è¿™ä¸ªé…åˆGoland IDEçš„File Watchersè®¾ç½®å¤ªçˆ½äº†ï¼Œæ–‡æ¡£å†…æœ‰ä»‹ç»

- `dao`ç›¸å…³ä»£ç çš„ç”Ÿæˆ
- `logic`çš„`init`æ–¹æ³•çš„è°ƒç”¨
- ......

è¯¦è§ä»£ç ç”Ÿæˆ-genï¼šhttps://goframe.org/pages/viewpage.action?pageId=1115790 







